query理解和处理，主要有query分词、query意图识别、query纠错、query改写，同时，也包括同义词挖掘、命名实体识别，紧密度分析
，以及时效性分析等，具体的可以参考下图
<img width="1080" height="451" alt="image" src="https://github.com/user-attachments/assets/98230521-15f1-4b65-999c-74c4e274a33c" />

**query分词**：\
query分词有细粒度和粗粒度，粗粒度主要考虑phrase，用来缓解语义飘逸，这样召回的doc的语义会尽量集中，但是这样召回的结果比较少，如果phrase又是比较低频的词条，可能出现召回的doc非常少的情况，所以业界一般是用细粒度的分词构建索引，并进行召回，粗粒度进行补充召回，同时，增加语义向量的召回结果进行补充，通过多路召回的方式来补充基于分词召回的不足

**词权重**：  
词权重主要用于基于基本的文本相关性，比如bm25，另外就是用于非比留的情况，有一些query中的不重要的词可以不用参与召回，避免召回不了目标结果或者相关结果\
词权重计算方法\
基于统计的，比如tfidf，但是存在oov问题\
基于传统的机器学习，通过特征工程和树模型，对term进行二分类，训练数据可以通过query和点击doc的title的共现词来构造\
基于深度学习，比如bert-score的方法或者end2end的词计算方法\
基于embedding方法，通过计算term和query的embedding的相似度\

**Query改写**\
用户输入的query不确定性非常大，有一些短query的歧义非常大，有一些长的query中冗余词非常多，另外，同样的语义，query的用词和doc的用词存在差异，还有一些query存在错字、多字、少字的问题\
query改写主要包括纠错、扩展、同义词替换  
-query纠错\
基于用户session的纠错对挖掘，共同点击doc的不同query的pair对，语言模型的转移概率，也可以利用seq2seq的方式进行纠错\
-同义词挖掘\
同义词主要解决query和doc的表述不一致的问题\

**意图**\
-构建意图类目体系\
-意图识别\
由于query是比较短，缺少足够的上下文信息，所以导致query意图可能存在多个的情况，因此意图识别更多的是输出一个多类目的概率分布，同时有一些query的需求是会不断变化的，比如出了一个热门事件可能导致同一个query的意图发生变化，另外，不同的用户对同一个query的意图也可能不一样，涉及到个性化问题，还有一些涉及到时间因素，不同时间段搜索需求也会变化\
分类模型简单的可以通过fasttext进行，速度快，同时考虑到一些垂类精度要求，可以补充词典来帮助提升意图识别的速度和精度要求\

参考文档\
1、https://zhuanlan.zhihu.com/p/393914267 \
2、https://github.com/ledmaster/tw-bert \
